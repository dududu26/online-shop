<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fashion Shop - Beranda</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    background: #f5f5f5;
  }

  /* Navbar Shopee-style */
  nav {
    background-color: #ffffff;
    padding: 12px 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 1000;
  }

  nav a {
  color: #333;
  background-color: #ff5722;
  text-decoration: none;
  margin: 0 3px;            /* Jarak antar tombol lebih kecil */
  font-weight: 500;
  font-size: 10px;          /* Ukuran teks diperkecil */
  padding: 2px 6px;         /* Kolom lebih ramping */
  border-radius: 200px;
  display: inline-block;
  transition: 0.3s;
  border: 1px solid #ffccbc; /* Garis luar tipis dan lembut */
}

nav a:hover {
  background-color: #fff;
  color: #ff5722;
  box-shadow: 0 0 5px rgba(255, 87, 34, 0.6);
}

  /* Brand / Logo di bawah navbar */
  .brand {
    font-weight: bold;
    font-size: 24px;
    text-align: center;
    color: #ff5722;
    margin: 20px auto;
    cursor: pointer;
  }

  h1 {
    text-align: center;
    margin: 0;
    background-color: #ff5722;
    color: white;
    padding: 0.1px;
    animation: blink 6s infinite;
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .filters {
    display: flex;
    gap: 10px;
    margin: 10px auto;
    flex-wrap: wrap;
    justify-content: center;
  }

  .filters input,
  .filters select {
    padding: 8px 12px;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 14px;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 20px;
    padding: 20px;
  }

  .card {
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    padding: 10px;
    text-align: center;
    position: relative;
    transition: transform 0.2s;
  }

  .card:hover {
    transform: translateY(-5px);
  }

  .card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-radius: 10px;
    cursor: pointer;
  }

  .card-body {
    margin-top: 10px;
  }

  .product-name {
    font-weight: 600;
    margin-bottom: 5px;
    color: #333;
  }

  .price {
    color: #ff5722;
    font-weight: bold;
  }

.image-wrapper {
  position: relative;
  display: inline-block;
}

.image-wrapper img {
  display: block;
  width: 100px;
  height: 100px;
  object-fit: cover;
}

.card {
  position: relative; /* biar anaknya bisa posisinya absolute relatif sini */
}

.select-product {
  position: absolute;
  top: 5px;
  right: 5px;
  z-index: 10; /* supaya di atas gambar */
  width: 20px; /* ukuran bisa disesuaikan */
  height: 20px;
  cursor: pointer;
  background: white;
  border-radius: 3px;
}

  #checkoutBtn {
    display: none;
    background: #ff5722;
    color: white;
    font-size: 16px;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    position: fixed;
    bottom: 10px;
    right: 20px;
    z-index: 1000;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }

  select.warna-select {
    margin-top: 8px;
    padding: 1px;
    border-radius: 4px;
    border: 1px solid #ccc;
    width: 50%;
  }

  /* Lightbox Modal */
  #lightboxModal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0,0,0,0.9);
    z-index: 2000;
    justify-content: center;
    align-items: center;
    flex-direction: column;
  }

  #lightboxModal img {
    max-width: 100vw;
    max-height: 80vh;
    object-fit: contain;
  }

  #lightboxModal span {
    position: absolute;
    top: 10px;
    right: 30px;
    font-size: 30px;
    color: white;
    cursor: pointer;
  }

  #lightboxModal button {
    padding: 10px 20px;
    font-size: 16px;
    margin: 10px;
    cursor: pointer;
  }

  #lightboxModal .nav-buttons {
    position: absolute;
    bottom: 30px;
    display: flex;
    gap: 20px;
  }
  #sliderPromo {
  display: flex;
  gap: 10px;
  overflow-x: auto;
  padding: 10px 0;
}

.promo-item {
  flex: 0 0 auto; /* supaya item tidak ikut mengecil */
  width: 120px;    /* atur lebar item */
  cursor: pointer;
  text-align: center;
  border: 1px solid #ddd;
  border-radius: 6px;
  padding: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  background: #fff;
  transition: transform 0.2s ease;
}

.promo-item:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.promo-item img {
  width: 100px;
  height: 100px;
  object-fit: contain;
  margin: 0 auto;
  display: block;
}
</style>
</head>
<body>

<nav>
 <div class="brand" onclick="window.location.href='index.html'">üõçÔ∏èOnline Fashion Shop</div>
  <div>

    <a href="co.html">Checkout</a>
    <a href="riwayat.html">Daftar pesanan</a>
    <a href="tentang.html">Tentang Kami</a>
   
  </div>
   
    
  <div class="filters">
    <input type="text" id="searchInput" placeholder="Cari nama produk..." />
    <select id="filterKategori"><option value="">Semua Kategori</option></select>
    <select id="filterJenis"><option value="">Semua Jenis</option></select>
  </div>
</nav>
<h1><strong>PROMO UNTUK ANDA</strong></h1>
<div id="sliderPromo" class="promo-slider"></div>
<div id="promoSlider" style="overflow-x: auto; white-space: nowrap; padding: 10px 0; margin: 0 auto; max-width: 100%;">
  <div id="promoContent" style="display: inline-flex; gap: 10px; padding-left: 16px;"></div>
  
  <div id="productGrid" class="grid"></div>
<button id="checkoutBtn">üõí Lanjut ke Checkout</button>

<!-- Lightbox Modal -->
<div id="lightboxModal">
  <span id="closeModal">&times;</span>
  <img id="lightboxImage" src="" />
  <div class="nav-buttons">
    <button id="prevBtn">‚è™ Prev</button>
    <button id="nextBtn">Next ‚è©</button>
  </div>
</div>
<footer style="background:#0a0a23; color:#fff; text-align:center; padding:20px 10px; margin-top:20px;">
  <p style="margin-bottom:10px; font-size:16px; font-weight:500;">Hubungi Kami:</p>
  <div style="display:flex; justify-content:center; gap:20px; font-size:24px;">
    <a href="https://instagram.com/wiwik_al_khairi" target="_blank" style="color:#E1306C;"><i class="fab fa-instagram"></i></a>
    <a href="https://wa.me/6281932704951?text=Hi%2C%20saya%20pengguna%20aplikasimu.%20Bisa%20bantu%20saya%3F" target="_blank" style="color:#25D366;"><i class="fab fa-whatsapp"></i></a>
    <a href="https://tiktok.com/@wiwikalfan" target="_blank" style="color:#3883;"><i class="fab fa-tiktok"></i></a>
  </div>
  <p style="margin-top:10px; font-size:14px; color:#aaa;">&copy; 2025 Online Fashion Shop</p>
</footer>

<!-- Tambahkan ini di HTML kamu, misalnya di dalam <body> -->
<div id="notification" style="
  position: fixed;
  top: 20px;
  right: 20px;
  background: #4CAF50;
  color: white;
  padding: 12px 20px;
  border-radius: 5px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  font-weight: 600;
  display: none;
  z-index: 9999;
  max-width: 300px;
  word-wrap: break-word;
"></div>
<!-- Modal Preview Produk -->
<div id="produkModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background-color:rgba(0,0,0,0.6); z-index:1000; justify-content:center; align-items:center;">
  <div style="background:#fff; padding:20px; border-radius:8px; max-width:400px; width:90%; position:relative;">
    <span id="closeModal" style="position:absolute; top:10px; right:15px; cursor:pointer; font-weight:bold;">&times;</span>
    <div id="modalContent"></div>
  </div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

const supabase = createClient(
  "https://ezciwtljpsxaahkipjnx.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV6Y2l3dGxqcHN4YWFoa2lwam54Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcxNDQ0NzUsImV4cCI6MjA2MjcyMDQ3NX0.dckoZp453R5N-uAOGEVgCmq33anWu8AXYWalJc6i1Fk"
);


  let index = 0;
  const h1 = document.getElementById("headline");

  setInterval(() => {
    index = (index + 1) % phrases.length;
    h1.textContent = phrases[index];
  }, 10000); // Ganti tiap 10 detik

const searchInput = document.getElementById("searchInput");
const filterKategori = document.getElementById("filterKategori");
const filterJenis = document.getElementById("filterJenis");
const container = document.getElementById("productGrid");
const checkoutBtn = document.getElementById("checkoutBtn");

let allProducts = [];
let selectedIds = new Set();

// Elemen notifikasi dan fungsi tampilkan notifikasi
const notifElem = document.getElementById("notification");
let notifTimeout = null;
function showNotification(message) {
  if (notifTimeout) clearTimeout(notifTimeout);
  notifElem.textContent = message;
  notifElem.style.display = "block";
  notifTimeout = setTimeout(() => {
    notifElem.style.display = "none";
  }, 3000); // Notifikasi hilang setelah 3 detik
}

async function loadProducts() {
const { data, error } = await supabase
  .from("produk")
  .select("id, nama, jenis, warna, ukuran, kategori, harga, gambar, deskripsi, stok, promo, diskon");

  if (error) {
    container.innerHTML = `<p>Gagal memuat produk: ${error.message}</p>`;
    return;
  }

  allProducts = data;
  populateFilters(data);
  displayProducts(data);
}

function populateFilters(data) {
  const kategoriSet = new Set();
  const jenisSet = new Set();

  data.forEach(p => {
    if (p.kategori) kategoriSet.add(p.kategori);
    if (p.jenis) jenisSet.add(p.jenis);
  });

  filterKategori.innerHTML += Array.from(kategoriSet).map(k => `<option value="${k}">${k}</option>`).join('');
  filterJenis.innerHTML += Array.from(jenisSet).map(j => `<option value="${j}">${j}</option>`).join('');
}

function getColorDropdownHTML(productId, warnaString) {
  const warnaList = warnaString.split(',').map(w => w.trim());
  if (warnaList.length <= 1) {
    return `<div class="warna">Warna: ${warnaList[0]}</div>`;
  }
  const options = warnaList.map(w => `<option value="${w}">${w}</option>`).join('');
  return `
    <div>
      <label for="warna-${productId}">Warna:</label>
      <select class="warna-select" data-id="${productId}" id="warna-${productId}">
        ${options}
      </select>
    </div>
  `;
}

function displayProducts(products) {
  container.innerHTML = "";

  if (products.length === 0) {
    container.innerHTML = "<p>Tidak ada produk ditemukan.</p>";
    return;
  }
  async function loadPromoSlider() {
  const { data: produkList, error } = await supabase
    .from("produk")
    .select("id, nama, gambar, promo, harga")
    .neq("promo", "");

  if (error || !produkList) return;

  const slider = document.getElementById("sliderPromo");
  slider.innerHTML = "";

  for (const produk of produkList) {
    let img = "https://via.placeholder.com/100";
    if (Array.isArray(produk.gambar) && produk.gambar[0]) {
      img = produk.gambar[0].startsWith("http") ? produk.gambar[0] : await getPublicUrl(produk.gambar[0]);
    } else if (typeof produk.gambar === "string") {
      img = produk.gambar.startsWith("http") ? produk.gambar : await getPublicUrl(produk.gambar);
    }

    const item = document.createElement("div");
    item.className = "promo-item";
   item.style.position = "relative";

const discountedPrice = produk.diskon && produk.diskon > 0
  ? produk.harga * (1 - produk.diskon / 100)
  : produk.harga;

const isProdukTerbatas = produk.stok > 0 && produk.stok <= 5;

item.innerHTML = `

  <img src="${img}" alt="${produk.nama}">
  ${isProdukTerbatas ? `
    <div style="
      position:absolute;
      top:5px;
      right:5px;
      background:#ff5722;
      color:white;
      padding:2px 2px;
      font-size:1px;
      font-weight:bold;
      border-radius:4px;
      z-index:10;">
      Produk Terbatas
    </div>` : ''
  }

  <div style="font-size: 12px; font-weight: bold; margin-top: 5px;">
    ${produk.nama}
  </div>

  ${
    produk.diskon && produk.diskon > 0
      ? `<div style="color: red; font-size: 11px;">
          Rp ${discountedPrice.toLocaleString("id-ID")} 
          <span style="font-weight: normal; color: orange;">(${produk.diskon}% OFF)</span>
        </div>`
      : `<div style="color: #007bff; font-size: 11px;">
          Rp ${produk.harga.toLocaleString("produk-id")}
        </div>`
  }
  ${produk.stok ? `<div style="font-size: 11px; color: green;">Stok: ${produk.stok}</div>` : ''}

  ${produk.promo ? `
    <div style="color:#007bff; font-size: 11px;">${produk.promo}</div>
  ` : ''}
`;
item.addEventListener("click", () => {
  // Scroll ke produk utama
  const targetCard = document.querySelector(`.card input[data-id="${produk.id}"]`)?.closest(".card");
  if (targetCard) {
    targetCard.scrollIntoView({ behavior: "smooth", block: "center" });
    // Tunggu sebentar sebelum lanjut
    setTimeout(() => {
      // Periksa stok dari elemen di allProducts
      const produkAsli = allProducts.find(p => p.id === produk.id);
      if (produkAsli && produkAsli.stok > 0) {
        const warnaDipilih = produkAsli.warna?.split(',')[0] ?? '';
        const checkoutProduk = [{
          ...produkAsli,
          warnaDipilih
        }];
        localStorage.setItem('produkCheckoutList', JSON.stringify(checkoutProduk));
        window.location.href = 'co.html';
      } else {
        showNotification("Stok produk ini kosong. Tidak bisa melanjutkan ke checkout.");
      }
    }, 500);
  } else {
    showNotification("Produk tidak ditemukan,stok telah habis.");
  }
});

document.getElementById("closeModal").onclick = function() {
  document.getElementById("produkModal").style.display = "none";
};
window.onclick = function(e) {
  if (e.target.id === "produkModal") {
    document.getElementById("produkModal").style.display = "none";
  }
};



    slider.appendChild(item);
  }
}

function tambahKeKeranjang(produk) {
  let keranjang = JSON.parse(localStorage.getItem("keranjang")) || [];

  const index = keranjang.findIndex(item => item.id === produk.id);
  if (index !== -1) {
    keranjang[index].jumlah += 1;
  } else {
    keranjang.push({
      id: produk.id,
      nama: produk.nama,
      harga: produk.harga,
      jumlah: 1
    });
  }

  localStorage.setItem("keranjang", JSON.stringify(keranjang));
}

// Panggil fungsi loadPromoSlider (pastikan supabase sudah siap)
loadPromoSlider();

  products.forEach(p => {
  const card = document.createElement("div");
  card.className = "card";
  card.style.position = "relative";

  const gambarURL = p.gambar || "https://via.placeholder.com/300x300.png?text=No+Image";
  const checked = selectedIds.has(p.id) ? "checked" : "";
  const isStokKosong = p.stok <= 0;
  const isProdukTerbatas = p.stok > 0 && p.stok <= 5;

  card.innerHTML = `
    ${!isStokKosong ? `<input type="checkbox" class="select-product" data-id="${p.id}" ${checked}>` : ""}
    <img src="${gambarURL}" alt="${p.nama}">
    ${isStokKosong ? `<div style="position:absolute; top:10px; right:10px; background:red; color:white; padding:4px 6px; font-size:12px; border-radius:4px;">Stok Habis</div>` : ""}
    <div class="card-body">
      <div class="product-name">${p.nama}</div>
      <div class="price"></div>
      <div class="stok">
      
        ${
          p.diskon && p.diskon > 0
            ? `<span style="text-decoration: line-through; color: grey;">Rp ${p.harga.toLocaleString("id-ID")}</span><br>
               <span style="color: red; font-weight: bold;">Rp ${(p.harga * (1 - p.diskon / 100)).toLocaleString("id-ID")}</span>`
            : `Rp ${p.harga.toLocaleString("id-ID")}`
        }
      </div>
      ${p.promo ? `<div style="color: orange; font-size: 14px;">promo ${p.promo}</div>` : ""}
      ${isProdukTerbatas ? `<div style="background:#ff9800; color:white; font-size:12px; padding:3px 6px; border-radius:4px; margin-top:6px; font-weight:bold;">Produk Terbatas</div>` : ""}
      <div class="stok">Stok: ${p.stok ?? 0}</div>
      ${p.warna ? getColorDropdownHTML(p.id, p.warna) : ''}
    </div>
  `;

  container.appendChild(card);
});

  toggleCheckoutButton();

  // Update checkbox event
  document.querySelectorAll(".select-product").forEach(checkbox => {
    checkbox.addEventListener("change", (e) => {
      const id = e.target.dataset.id;
      const product = allProducts.find(p => p.id === id);

      if (product && product.stok <= 0) {
        showNotification("Produk ini stoknya kosong dan tidak dapat dipilih.");
        e.target.checked = false;
        return;
      }

      if (e.target.checked) {
        selectedIds.add(id);
      } else {
        selectedIds.delete(id);
      }
      toggleCheckoutButton();
    });
  });
}

function toggleCheckoutButton() {
  checkoutBtn.style.display = selectedIds.size > 0 ? "block" : "none";
}

function applyFilters() {
  const keyword = searchInput.value.toLowerCase();
  const kategori = filterKategori.value;
  const jenis = filterJenis.value;

  const filtered = allProducts.filter(p => {
    return (
      p.nama?.toLowerCase().includes(keyword) &&
      (kategori === "" || p.kategori === kategori) &&
      (jenis === "" || p.jenis === jenis)
    );
  });

  displayProducts(filtered);
}

checkoutBtn.addEventListener("click", () => {
  const selectedProduk = allProducts
    .filter(p => selectedIds.has(p.id))
    .map(p => {
      const warnaDropdown = document.querySelector(`select[data-id="${p.id}"]`);
      return {
        ...p,
        warnaDipilih: warnaDropdown ? warnaDropdown.value : (p.warna?.split(',')[0] ?? '')
      };
    });

  if (selectedProduk.length === 0) {
    showNotification("Pilih minimal 1 produk sebelum melanjutkan.");
    return;
  }

  localStorage.setItem('produkCheckoutList', JSON.stringify(selectedProduk));
  window.location.href = 'co.html';
});

searchInput.addEventListener("input", applyFilters);
filterKategori.addEventListener("change", applyFilters);
filterJenis.addEventListener("change", applyFilters);

loadProducts();

// Lightbox logic
let currentImageIndex = 0;
let currentImageList = [];

document.addEventListener("click", (e) => {
  if (e.target.tagName === "IMG" && e.target.closest(".card")) {
    const allImages = Array.from(document.querySelectorAll(".card img"));
    currentImageList = allImages.map(img => img.src);
    currentImageIndex = allImages.indexOf(e.target);

    showImage(currentImageIndex);
    document.getElementById("lightboxModal").style.display = "flex";
  }
});

document.getElementById("closeModal").addEventListener("click", () => {
  document.getElementById("lightboxModal").style.display = "none";
});

document.getElementById("prevBtn").addEventListener("click", () => {
  if (currentImageIndex > 0) {
    currentImageIndex--;
    showImage(currentImageIndex);
  }
});

document.getElementById("nextBtn").addEventListener("click", () => {
  if (currentImageIndex < currentImageList.length - 1) {
    currentImageIndex++;
    showImage(currentImageIndex);
  }
});

function showImage(index) {
  const imgElement = document.getElementById("lightboxImage");
  imgElement.src = currentImageList[index];
}

</script>
</body>
</html>